<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fishing Man - ‡∏£ ‡∏´‡∏±‡∏ô Adventure</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4fc3f7;
            --secondary: #ffb74d;
            --dark: #012a4a;
            --white: #ffffff;
            --glass: rgba(255, 255, 255, 0.15);
            --danger: #ff5252;
            --success: #4caf50;
        }

        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            font-family: 'Kanit', sans-serif; overflow: hidden; 
            background: var(--dark);
        }

        #game-container { 
            position: relative; width: 100vw; height: 100vh; 
            background: linear-gradient(180deg, #81d4fa 0%, #0277bd 40%, #012a4a 100%);
            overflow: hidden;
        }

        /* --- UI Layer --- */
        .ui-layer {
            position: absolute; top: 20px; left: 0; right: 0;
            display: flex; justify-content: space-around; align-items: flex-start;
            z-index: 100; pointer-events: none;
        }

        .score-card {
            background: var(--glass);
            backdrop-filter: blur(10px);
            padding: 10px 25px;
            border-radius: 20px;
            border: 2px solid rgba(255,255,255,0.2);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            color: white; text-align: center; min-width: 120px;
        }

        .timer-badge {
            display: flex; align-items: center; gap: 10px;
            background: rgba(0, 0, 0, 0.3); padding: 5px 20px;
            border-radius: 50px; border: 2px solid white;
        }
        .clock-icon { width: 35px; height: 35px; object-fit: contain; }

        /* --- Audio Controls --- */
        #audio-controls {
            position: absolute; top: 20px; right: 20px; z-index: 300;
            background: var(--glass); padding: 10px; border-radius: 50%;
            cursor: pointer; border: 2px solid white; pointer-events: auto;
            width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;
            color: white; font-size: 20px;
        }

        /* --- Screens --- */
        #overlay, #game-over, #report-modal {
            position: absolute; inset: 0;
            background: rgba(1, 42, 74, 0.9);
            backdrop-filter: blur(8px);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 200; transition: 0.5s;
        }
        #game-over, #report-modal { display: none; }

        .report-box {
            background: white; width: 85%; max-width: 500px;
            max-height: 70vh; border-radius: 20px; padding: 20px;
            overflow-y: auto; color: var(--dark);
        }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        td, th { padding: 12px; border-bottom: 1px solid #eee; text-align: left; }

        .btn-play {
            padding: 15px 40px; font-size: 22px; cursor: pointer;
            background: var(--secondary); color: var(--dark);
            border: none; border-radius: 100px; font-weight: 700;
            box-shadow: 0 6px 0 #e65100; transition: 0.2s; margin: 10px;
            pointer-events: auto;
        }
        .btn-play:active { transform: translateY(4px); box-shadow: 0 2px 0 #e65100; }
        .btn-report { background: #4fc3f7; box-shadow: 0 6px 0 #0288d1; color: white; }

        #countdown {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 150px; font-weight: 700; color: var(--secondary);
            display: none; z-index: 150;
        }

        .mobile-controls { position: absolute; bottom: 40px; right: 40px; z-index: 100; }
        .btn-cast {
            width: 80px; height: 80px; border-radius: 50%; background: var(--secondary);
            border: 5px solid white; color: var(--dark); font-weight: bold; cursor: pointer;
        }
    </style>
</head>
<body>

    <audio id="bgMusic" loop>
        <source src="SoundBG.mp3" type="audio/mpeg">
    </audio>

    <div id="game-container">
        <div id="audio-controls" onclick="toggleMute()">üîä</div>

        <div class="ui-layer">
            <div class="score-card">
                <p style="margin:0; font-size: 14px;">SCORE</p>
                <h2 id="score">000</h2>
            </div>
            <div class="timer-container">
                <div class="timer-badge" id="timer-box">
                    <img src="Clock.png" alt="Clock" class="clock-icon">
                    <h2 id="timer">60</h2>
                </div>
            </div>
            <div class="score-card">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: <b>"‡∏£‡∏£"</b></div>
        </div>

        <div id="overlay">
            <h1 style="color:white; font-size: 50px; margin:0;">FISHING MAN ‡∏ï‡∏∞‡∏•‡∏∏‡∏¢‡πÇ‡∏•‡∏Å‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢</h1>
            <p style="color:white; margin-bottom: 30px;">‡∏ï‡∏≠‡∏ô ‡∏Ñ‡∏≥ ‡∏£ ‡∏´‡∏±‡∏ô By FORKRU.it X ‡∏Ñ‡∏£‡∏π‡∏Æ‡∏≤‡∏™‡πÄ‡∏°‡∏≤‡∏∞</p>
            <button class="btn-play" id="start-btn" onclick="startSequence()">‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</button>
        </div>

        <div id="game-over">
            <h1 style="color:white; font-size: 50px; margin:0;">‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤!</h1>
            <h2 id="final-score" style="font-size: 80px; color: var(--secondary); margin: 10px 0;">0</h2>
            <div style="display: flex;">
                <button class="btn-play btn-report" onclick="showReport()">‡∏î‡∏π‡πÄ‡∏â‡∏•‡∏¢</button>
                <button class="btn-play" onclick="location.reload()">‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà</button>
            </div>
        </div>

        <div id="report-modal">
            <div class="report-box">
                <h2 style="text-align:center; margin-top:0;">‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ</h2>
                <table>
                    <thead>
                        <tr><th>‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå</th><th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th><th>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th></tr>
                    </thead>
                    <tbody id="report-list"></tbody>
                </table>
            </div>
            <button class="btn-play" onclick="location.reload()">‡∏ï‡∏Å‡∏•‡∏á (‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà)</button>
        </div>

        <div id="countdown">3</div>
        <div class="mobile-controls"><button class="btn-cast" onmousedown="castLine()" ontouchstart="castLine()">PUSH</button></div>
        <canvas id="gameCanvas"></canvas>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreElement = document.getElementById('score');
        const timerElement = document.getElementById('timer');
        const bgMusic = document.getElementById('bgMusic');
        const audioBtn = document.getElementById('audio-controls');
        
        let width, height, score = 0, timeLeft = 60, gameState = "MENU";
        let hookY, waterLineY, isCasting = false, isReturning = false;
        let activeWords = [], bubbles = [], particles = [], caughtHistory = [];
        let notifications = []; // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏Å‡πÑ‡∏î‡πâ
        let gameTimerInterval, isMuted = false;

        function toggleMute() {
            isMuted = !isMuted;
            bgMusic.muted = isMuted;
            audioBtn.innerText = isMuted ? "üîá" : "üîä";
        }

        const fishImages = [];
        const fishSrcs = ['Fish1.png', 'Fish2.png', 'Fish3.png', 'Fish4.png'];
        let loadedCount = 0;

        fishSrcs.forEach(src => {
            const img = new Image();
            img.src = src;
            img.onload = () => { if(++loadedCount === fishSrcs.length) document.getElementById('start-btn').innerText = "‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°"; };
            fishImages.push(img);
        });

        const wordsPool = [
            { text: "‡∏Å‡∏£‡∏£‡πÑ‡∏Å‡∏£", isRR: true }, { text: "‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î", isRR: true }, 
            { text: "‡∏°‡∏£‡∏£‡∏¢‡∏≤‡∏ó", isRR: true }, { text: "‡∏û‡∏£‡∏£‡∏©‡∏≤", isRR: true },
            { text: "‡∏´‡∏£‡∏£‡∏©‡∏≤", isRR: true }, { text: "‡∏†‡∏£‡∏£‡∏¢‡∏≤", isRR: true },
            { text: "‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå", isRR: true }, { text: "‡∏ß‡∏£‡∏£‡∏ì‡∏Ñ‡∏î‡∏µ", isRR: true },
            { text: "‡∏£‡∏∞‡∏Ü‡∏±‡∏á", isRR: false }, { text: "‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß", isRR: false }, 
            { text: "‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô", isRR: false }, { text: "‡∏£‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô", isRR: false }
        ];

        function resize() {
            width = window.innerWidth; height = window.innerHeight;
            canvas.width = width; canvas.height = height;
            waterLineY = height * 0.25; hookY = waterLineY;
        }
        window.addEventListener('resize', resize);
        resize();

        function startSequence() {
            if(loadedCount < 4) return;
            bgMusic.play().catch(e => console.log("Audio play deferred"));
            document.getElementById('overlay').style.display = "none";
            const cd = document.getElementById('countdown');
            cd.style.display = "block";
            let c = 3;
            let t = setInterval(() => {
                cd.innerText = c > 0 ? c : "GO!";
                if(c < 0) { clearInterval(t); cd.style.display = "none"; startGame(); }
                c--;
            }, 800);
        }

        function startGame() {
            gameState = "PLAYING";
            score = 0; timeLeft = 60; caughtHistory = []; notifications = [];
            spawnWords(); createBubble();
            gameTimerInterval = setInterval(() => {
                timeLeft--;
                timerElement.innerText = timeLeft;
                if(timeLeft <= 0) endGame();
            }, 1000);
        }

        function endGame() {
            gameState = "GAMEOVER";
            clearInterval(gameTimerInterval);
            bgMusic.pause();
            document.getElementById('final-score').innerText = score;
            document.getElementById('game-over').style.display = "flex";
        }

        function showReport() {
            const list = document.getElementById('report-list');
            list.innerHTML = caughtHistory.map(item => `
                <tr>
                    <td>${item.text}</td>
                    <td style="color:${item.isRR ? 'green':'red'}; font-weight:bold">${item.isRR ? '‡∏£ ‡∏´‡∏±‡∏ô' : '‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà'}</td>
                    <td style="color:${item.point > 0 ? 'green':'red'}; font-weight:bold">${item.point > 0 ? '+'+item.point : item.point}</td>
                </tr>
            `).join('');
            document.getElementById('report-modal').style.display = "flex";
        }

        function spawnWords() {
            if(gameState !== "PLAYING") return;
            const w = wordsPool[Math.floor(Math.random()*wordsPool.length)];
            activeWords.push({
                ...w, fishImg: fishImages[Math.floor(Math.random()*4)],
                x: width + 150, y: waterLineY + 100 + Math.random()*(height-waterLineY-200),
                speed: 1.5 + Math.random()*4, sinOffset: Math.random()*10, size: 24
            });
            setTimeout(spawnWords, 900 + Math.random()*1000);
        }

        function createBubble() {
            if(gameState !== "PLAYING") return;
            bubbles.push({ x: Math.random()*width, y: height+20, speed: 0.5+Math.random()*1.5 });
            setTimeout(createBubble, 500);
        }

        function createParticles(x, y, color) {
            for(let i=0; i<8; i++) particles.push({ x, y, vx:(Math.random()-0.5)*10, vy:(Math.random()-0.5)*10, life:1.0, color });
        }

        // --- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á Floating Notification ---
        function addNotification(text, x, y, point) {
            notifications.push({
                text: `‡∏ï‡∏Å‡πÑ‡∏î‡πâ ${text} ${point > 0 ? '+' + point : point}`,
                x: x,
                y: y,
                life: 1.0, // ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏á
                color: point > 0 ? '#4caf50' : '#ff5252'
            });
        }

        function draw() {
            ctx.clearRect(0,0,width,height);
            
            // Bubbles
            bubbles.forEach((b,i) => {
                b.y -= b.speed;
                ctx.strokeStyle = "rgba(255,255,255,0.2)";
                ctx.beginPath(); ctx.arc(b.x, b.y, 4, 0, Math.PI*2); ctx.stroke();
                if(b.y < waterLineY) bubbles.splice(i,1);
            });

            // Water
            ctx.fillStyle = "rgba(255,255,255,0.2)";
            ctx.beginPath(); ctx.moveTo(0, waterLineY);
            for(let x=0; x<=width; x+=20) ctx.lineTo(x, waterLineY + Math.sin(x*0.01 + Date.now()*0.002)*5);
            ctx.lineTo(width,height); ctx.lineTo(0,height); ctx.fill();

            // Hook
            ctx.strokeStyle = "white"; ctx.beginPath(); ctx.moveTo(width/2, 0); ctx.lineTo(width/2, hookY); ctx.stroke();
            ctx.strokeStyle = "#ffb74d"; ctx.lineWidth=4; ctx.beginPath(); ctx.arc(width/2-5, hookY, 8, 0.2, Math.PI-0.2); ctx.stroke(); ctx.lineWidth=1;

            // Particles
            particles.forEach((p,i) => {
                p.x+=p.vx; p.y+=p.vy; p.life-=0.02;
                ctx.fillStyle = `rgba(${p.color==='gold'?'255,215,0':'255,82,82'},${p.life})`;
                ctx.beginPath(); ctx.arc(p.x, p.y, 3, 0, Math.PI*2); ctx.fill();
                if(p.life<=0) particles.splice(i,1);
            });

            // Fish & Collision
            if(gameState === "PLAYING") {
                activeWords.forEach((w,i) => {
                    w.x -= w.speed;
                    let fy = w.y + Math.sin(Date.now()*0.003 + w.sinOffset)*15;
                    ctx.drawImage(w.fishImg, w.x-90, fy-50, 180, 100);
                    ctx.font = "bold 24px Kanit"; ctx.textAlign="center";
                    ctx.strokeStyle="black"; ctx.lineWidth=4; ctx.strokeText(w.text, w.x, fy+8);
                    ctx.fillStyle="white"; ctx.fillText(w.text, w.x, fy+8);
                    
                    if(isCasting && !isReturning) {
                        if(Math.abs(width/2 - w.x) < 70 && Math.abs(hookY - fy) < 50) {
                            let p = w.isRR ? 10 : -20; // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏´‡∏±‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏õ‡πá‡∏ô -20 ‡∏ï‡∏≤‡∏°‡∏™‡∏±‡πà‡∏á
                            score = Math.max(0, score + p);
                            
                            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                            caughtHistory.push({ text: w.text, isRR: w.isRR, point: p });
                            addNotification(w.text, width/2, hookY, p);
                            
                            createParticles(width/2, hookY, w.isRR?'gold':'red');
                            scoreElement.innerText = score.toString().padStart(3,'0');
                            activeWords.splice(i,1); isReturning = true;
                        }
                    }
                    if(w.x < -200) activeWords.splice(i,1);
                });

                // ‡∏ß‡∏≤‡∏î Floating Notifications
                notifications.forEach((n, i) => {
                    n.y -= 1.5; // ‡∏•‡∏≠‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô‡∏ä‡πâ‡∏≤‡πÜ
                    n.life -= 0.015; // ‡∏Ñ‡πà‡∏≠‡∏¢‡πÜ ‡∏à‡∏≤‡∏á‡∏´‡∏≤‡∏¢
                    ctx.font = "bold 28px Kanit";
                    ctx.textAlign = "center";
                    ctx.strokeStyle = "black";
                    ctx.lineWidth = 4;
                    ctx.globalAlpha = n.life;
                    ctx.strokeText(n.text, n.x, n.y);
                    ctx.fillStyle = n.color;
                    ctx.fillText(n.text, n.x, n.y);
                    ctx.globalAlpha = 1.0;
                    if(n.life <= 0) notifications.splice(i, 1);
                });

                if(isCasting && !isReturning) { hookY += 18; if(hookY > height-50) isReturning=true; }
                else if(isReturning) { hookY -= 15; if(hookY <= waterLineY) { hookY=waterLineY; isCasting=false; isReturning=false; } }
            }
            requestAnimationFrame(draw);
        }

        function castLine() { if(gameState==="PLAYING" && !isCasting) isCasting=true; }
        window.addEventListener('keydown', e => { if(e.code==='Space') castLine(); });
        draw();
    </script>
</body>
</html>
